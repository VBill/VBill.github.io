<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"vbill.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一个普通的Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="BillVYoung&#39;s Blog">
<meta property="og:url" content="https://vbill.github.io/page/3/index.html">
<meta property="og:site_name" content="BillVYoung&#39;s Blog">
<meta property="og:description" content="一个普通的Blog">
<meta property="og:locale">
<meta property="article:author" content="BillVYoung">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://vbill.github.io/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'default'
  };
</script>

  <title>BillVYoung's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BillVYoung's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://vbill.github.io/2015/02/12/Xposed-IntelliJ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BillVYoung">
      <meta itemprop="description" content="一个普通的Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BillVYoung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/02/12/Xposed-IntelliJ/" class="post-title-link" itemprop="url">IntelliJ下开发Xposed模块无法运行</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-02-12 20:18:08" itemprop="dateCreated datePublished" datetime="2015-02-12T20:18:08+08:00">2015-02-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-18 17:29:14" itemprop="dateModified" datetime="2020-10-18T17:29:14+08:00">2020-10-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>昨天按照github上Xposed的官方教程写Xposed模块，但是怎么也运行不起来。后来查log发现报错了。错误是 <code>java.lang.IllegalAccessError: Class ref in pre-verified class resolved to unexpected implementation</code>。</p>
<p>解决方法是：鼠标右键点击工程，选择“Open Module Settings”，在弹出的窗口中打开Dependencies选项卡。把XposedBridgeApi这个jar包后面的Scope属性改成provided。</p>
<p>解决方案<a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/15605898/java-lang-illegalaccesserror-class-ref-in-preverified-class-resolved-to-unexpect/18335122#18335122">来源</a>。有一篇文章讲了<a target="_blank" rel="noopener" href="http://www.alloyteam.com/2014/04/android-cha-jian-yuan-li-pou-xi/">原理</a>，以后留着看。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://vbill.github.io/2015/02/11/Xposed-helpers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BillVYoung">
      <meta itemprop="description" content="一个普通的Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BillVYoung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/02/11/Xposed-helpers/" class="post-title-link" itemprop="url">（译）Xposed Helpers</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-02-11 20:18:08" itemprop="dateCreated datePublished" datetime="2015-02-11T20:18:08+08:00">2015-02-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-18 17:29:14" itemprop="dateModified" datetime="2020-10-18T17:29:14+08:00">2020-10-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://github.com/rovo89/XposedBridge/wiki/Helpers">原文地址</a>。主要讲解Xposed框架helper类里的各种方法。</p>
<p>Xposed中有许多Helper方法使得模块的开发变得更为简单。</p>
<h2 id="xposedbridge类"># XposedBridge类</h2>
<h2 id="log">log</h2>
<p><code>log</code>方法是一个向标准logcat和<code>/data/xposed/debug.log</code>文件输出错误信息的简单方式。它可以捕获日志信息或者一个<code>Throwable</code>对象。后面的例子中，它将打印堆栈踪迹。</p>
<h2 id="hookallmethods-hookallconstructors">hookAllMethods / hookAllConstructors</h2>
<p>如果你想把所有的方法都以一个指定的名称hook起来，或是hook类中所有的构造函数，你可以使用这两种方法。当有许多不同的变量，可是你希望在它们当中任何一个被调用之前/后都执行一段代码时，这是非常有用的。时刻记住，其它的ROM也许有额外的变量同样也被hook。尤其小心你在回调时得到的<code>args</code>。</p>
<h2 id="xposedhelpers类"># XposedHelpers类</h2>
<p>我建议把这个类添加到Eclipse的<strong>静态导入</strong>的偏好设置中：Window =&gt; Preferences =&gt; Java =&gt; Editor =&gt; Content Assist =&gt; Favorites =&gt; New Type，输入：de.robv.android.xposed.XposedHelpers。这样做的话，eclipse在你开始输入“get…”时会自动提示这个类中的方法，并且会创建这个方法的静态导入（这意味着在你的代码中是看不到类名的）。</p>
<h2 id="findmethod-findconstructor-findfield">findMethod / findConstructor / findField</h2>
<p>有许多你不必亲自使用反射获得方法、构造函数和字段的方式。同样，你也可以对几个特定参数种类使用“最佳匹配”来寻找方法和构造函数。比如：你可以用一个<code>TextView</code>类型的参数来调用<code>findMethodBestMatch(Class&lt;?&gt; clazz, String methodName, Object... args)</code>。如果没有更加符合匹配的变量，这同样会找到一个具有你指定的名称而且以View类型对象作为参数的方法。</p>
<h2 id="callmethod-callstaticmethod-newinstance">callMethod / callStaticMethod / newInstance</h2>
<p>利用上文提到的findXXX方法，这些方法使得调用方法和创建一个类的实例变得简单。调用者不必为此而使用反射。没有必要事先就取得某个方法，只要及时使用以上的这些方法调用它就可以了。参数类型是从实际的参数值和最匹配的被调用方法中自动拷贝而来。万一你想明确的指出参数的类型，创建一个<code>Class&lt;?&gt;</code>数组，然后把它传递给callXXX/newInstance。你可以使数组中的一些项为空（null）来使用实际参数的类型。但是数组的长度必须和参数的个数匹配。</p>
<h2 id="getxxxfield-setxxxfield-getstaticxxxfield-setstaticxxxfield">getXXXField / setXXXField / getStaticXXXField /setStaticXXXField</h2>
<p>它们是让你能够轻易获得和设置对象实例和类变量内容的封装器。你只需要对象的引用、字段名、和类型（当然还有提供给setter的新值）。如果你想获得/设置一个静态字段，并且没有对象的引用，你可以使用<code>getStaticXXX</code>和 <code>setStaticXXX</code>方法。然而当你有一个对象的引用时，区分静态和实例字段是没有必要的。<code>getXXX</code>和<code>setXXX</code>可以给两者都设定值。</p>
<h2 id="getadditionalxxxfield-setadditionalxxxfield">getAdditionalXXXField / setAdditionalXXXField</h2>
<p>这些方法让你将任何值与一个对象的实例或是整个类（像是一个静态字段）联系起来。这些值依照关键字-值对的方式存储。所以每个对象可以存储多个值。关键字可以是任何字符串，包括对象实际拥有的字段的名称。请注意你不能通过调用<code>getAdditionalInstanceField</code>获取你之前用<code>setAdditionalStaticField</code>存储的值。取而代之的是应该使用<code>getAdditionalStaticField</code>。它有一个变量来接受对象并自动查询它的类。</p>
<h2 id="assetasbytearray">assetAsByteArray</h2>
<p>这个方法以byte数组的形式返回资源。如果你想加载你模块的资源，你可以使用以下代码：</p>
<pre><code>public class XposedTweakbox implements IXposedHookZygoteInit &#123;
    @Override
    public void initZygote(StartupParam startupParam) throws Throwable &#123;
        Resources tweakboxRes = XModuleResources.createInstance(startupParam.modulePath, null);
        byte[] crtPatch = assetAsByteArray(tweakboxRes, &quot;crtfix_samsung_d506192d5049a4042fb84c0265edfe42.bsdiff&quot;);
...</code></pre>
<h2 id="getmd5sum">getMD5Sum</h2>
<p>返回文件系统中一个文件的MD5值。当前的app需要获取读这个文件的权限（在<code>init</code>方法中你拥有root权限，所以这应该不是什么问题）。</p>
<h2 id="getprocesspid">getProcessPid</h2>
<p>按照进程的/proc/[pid]/cmdline的第一部分来寻找这个进程，并以字符串形式返回它的PID。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://vbill.github.io/2015/02/10/xposed-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BillVYoung">
      <meta itemprop="description" content="一个普通的Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BillVYoung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/02/10/xposed-1/" class="post-title-link" itemprop="url">（译）Xposed模块开发教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-02-10 20:18:08" itemprop="dateCreated datePublished" datetime="2015-02-10T20:18:08+08:00">2015-02-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-18 17:29:14" itemprop="dateModified" datetime="2020-10-18T17:29:14+08:00">2020-10-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://github.com/rovo89/XposedBridge/wiki/Development-tutorial">原文地址</a>。这是开发者所写的，可以说是官方开发指南。文章讲述了Xposed的原理，以及怎么开发Xposed框架的模块。头一次翻译技术文档，有错误的话请多包涵。</p>
<p>好了，你想学习怎么为Xposed开发新的模块么？那么读读这篇教程（或者我们可以称他为”泛读短文”）学着怎么去做。这不仅包括“创建这个文件然后插入…”这类的技巧，也包括这些技巧背后的思想。这些思想正是创造价值的步骤以及你真正需要了解你做了什么和为什么这么做的原因。如果你觉得本文“太长，不想读”，那么你可以只看最后的源代码和阅读“<a href="#使工程成为Xposed模块">使工程成为Xposed模块</a>“部分。但是如果你读了整篇文章你就会有更好的理解。你之后会节省出来阅读这个的时间，因为你不必凭自己弄清楚每件事。</p>
<h2 id="修改主题"># 修改主题</h2>
<p>你将重新创建在<a target="_blank" rel="noopener" href="https://github.com/rovo89/XposedExamples/tree/master/RedClock">github</a>上可以找到的红色钟表的的例子。它包括将状态栏的钟表变为红色并且加入一个笑脸的功能。我选择这个例子是因为它非常小，而且容易看见所做的修改。并且，它也使用了框架所提供的一些基本方法。</p>
<h2 id="xposed如何工作"># Xposed如何工作</h2>
<p>在你开始做出自己的修改之前，你应当大致了解Xposed如何工作（如果觉得这部分无聊可以跳过）。以下就是原理：</p>
<p>有一个叫做”Zygote”的进程，它是android运行环境的核心。每个应用都从一份它的拷贝(“fork”)产生。这个进程在手机启动时由一个叫 /init.rc 的脚本启动。这个进程的启动在 /system/bin/app_process 加载所需要的类和调用初始化方法后完成。</p>
<p>这里就是Xposed发挥用处的地方了。当你安装完框架后，<a target="_blank" rel="noopener" href="https://github.com/rovo89/Xposed">一个扩展过的app_process</a>就会被复制到 /system/bin 下。这个扩展过的启动进程会将一个额外的jar包添加到环境变量，并在特定场合调用里面的方法。比如：当虚拟机创建完成后和Zygote的main方法被调用前。并且在那个方法当中，我们已经是Zygote的一部分，而且能够在它的上下文context中活动。</p>
<p>jar包的位置是 /data/data/de.robv.android.xposed.installer/bin/XposedBridge.jar 它的源代码可以在<a target="_blank" rel="noopener" href="https://github.com/rovo89/XposedBridge">这里</a>找到。查看<a target="_blank" rel="noopener" href="https://github.com/rovo89/XposedBridge/blob/master/src/de/robv/android/xposed/XposedBridge.java">XposedBridge</a>的类，你能找到main方法。这就是我上文中所写过的，它在每个进程的最开始部分被调用。一些初始化的工作在那里完成，并且我们的模块在那里加载（之后我再讲模块的加载）。</p>
<h2 id="方法的hook替换"># 方法的hook/替换</h2>
<p>真正使Xpoesed有威力的就是hook方法调用。当你反编译并修改APK时，你能够在任何你想的地方直接修改/替换指令。然而，你事后需要重新编译/给APK签名，并且只能发布整个安装包。使用Xposed能让你放置的hook，你并不能修改程序内部的方法代码(清楚地定义你想要在何处做什么样的修改是不可能的)。然而，你可以在方法调用的前后注入你的代码。这也是java中能够被清楚寻址的最小单位。</p>
<p>XposedBridge 有一个私有的 native 方法叫做 hookMethodNative。这个方法也在扩展后的 app_process 中被实现了。它会将方法类型转为“native”，并把方法的实现与本地的通用方法相连。这意味着，每当被hook的方法调用后，调用者不知道实际调用的是通用的方法。在这个方法中，位于 XposedBridge 的 handleHookedMethod 方法会被调用，并向方法调用传递参数、this指针以及其他东西。之后这个方法负责唤起之前方法调用注册过的回调。上述这些行为能够改变调用的参数、实例/静态变量、唤起其他方法、处理调用结果。。。或者跳过这些东西。它的弹性非常大。</p>
<p>好了，理论讲够了。我们现在创建一个模块吧！</p>
<h2 id="创建工程"># 创建工程</h2>
<p>一个模块就是一个普通的app，只不过多了一些特殊的文件和元数据。所以在我们创建新的android工程以前，我假设你已经做过这个了。如果没有，<a target="_blank" rel="noopener" href="http://developer.android.com/sdk/installing.html">官方文档</a>讲的很详细。对于SDK，我选择了4.0.3（API15）。我建议你也使用这个，并且不要立刻开始。你不需要创建Activity，因为我们的修改不需要任何用户界面。回答过了这个问题后，你应该有一个空白的工程项目。</p>
<h2 id="使工程成为xposed模块"># 使工程成为Xposed模块</h2>
<p>现在我们把工程变成Xposed能加载的东西。我们需要以下几个步骤。</p>
<h2 id="androidmanifest.xml">AndroidManifest.xml</h2>
<p>Xposed Installer的模块列表搜寻所有有一种特殊元数据标记的应用程序。你可以到 AndroidManifest.xml =&gt; Application =&gt; Application Nodes (在底部) =&gt; Add =&gt; Meta Data 下面去创建这个标记。标记名称应该是 xposedmodule ，值应该是 true。给resource留空。重复以上过程创建 xposedminversion (见下文) 和 xposeddescription (你创建的模块的简单描述)。XML文件现在就是这个样子：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
 &lt;manifest  xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    package=&quot;de.robv.android.xposed.mods.tutorial&quot;
    android:versionCode=&quot;1&quot;
    android:versionName=&quot;1.0&quot; &gt;

    &lt;uses-sdk android:minSdkVersion=&quot;15&quot; /&gt;

    &lt;application
        android:icon=&quot;@drawable/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot; &gt;
        &lt;meta-data
            android:name=&quot;xposedmodule&quot;
            android:value=&quot;true&quot; /&gt;
        &lt;meta-data
            android:name=&quot;xposeddescription&quot;
            android:value=&quot;Easy example which makes the status bar clock red and adds a smiley&quot; /&gt;
        &lt;meta-data
            android:name=&quot;xposedminversion&quot;
            android:value=&quot;30&quot; /&gt;
    &lt;/application&gt;
&lt;/manifest&gt;</code></pre>
<h2 id="xposedbridgeapi.jar">XposedBridgeApi.jar</h2>
<p>接下来，让程序能够找到 XposedBridge 的API。你可以从 <a target="_blank" rel="noopener" href="http://forum.xda-developers.com/xposed/xposed-api-changelog-t2714067">这里</a>下载 <code>XposedBridgeApi-&lt;version&gt;.jar</code> 的最新版。把它复制到叫做lib的子文件夹下。右键单击选择Build Path =&gt; Add to Build Path。文件名当中的<code>&lt;version&gt;</code>是你在manifest文件的xposedminversion标签所插入的版本。</p>
<blockquote>
<p>保证API类没有被包含（但仅仅是参考）在你编译过的APK里，否则你会得到一个IllegalAccessError错误。libs（含有s）文件夹是eclipse自动生成的，不要把API文件放在那里。</p>
</blockquote>
<h2 id="模块的实现">模块的实现</h2>
<p>现在你可以给你的模块创建一个类了。我的类叫做”Tutorial”，位于de.robv.android.xposed.mods.tutorial这个包中。</p>
<pre><code>package de.robv.android.xposed.mods.tutorial;

public class Tutorial &#123;

&#125;</code></pre>
<p>第一步，我们仅仅生成一些日志表明模块已经加载。一个模块可以有多个入口点。你选择哪个取决于你想修改什么。你可以在安卓系统启动时、在一个app将要启动时、在一个app的资源文件初始化时或其他时候，调用一个函数。</p>
<p>在这个教程靠后面的一部分，你将了解到在一个特定的app中需要做出的修改。那么先让我们了解一下 “让我知道什么时候加载一个新app” 这个入口点。所有入口点都被标记为IXposedMod的子接口。这种情况下，你需要实现 IXposedHookLoadPackage 这个接口。其实它只有一个仅有一个参数的方法。这个方法向被实现的模块提供更多关于运行环境上下文的信息。在我们的例子中，我们用log输出加载的app的名称。</p>
<pre><code>package de.robv.android.xposed.mods.tutorial;

import de.robv.android.xposed.IXposedHookLoadPackage;
import de.robv.android.xposed.XposedBridge;
import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;

public class Tutorial implements IXposedHookLoadPackage &#123;
    public void handleLoadPackage(final LoadPackageParam lpparam) throws Throwable &#123;
        XposedBridge.log(&quot;Loaded app: &quot; + lpparam.packageName);
    &#125;
&#125;</code></pre>
<p>这个log方法向标准logcat以及 /data/data/de.robv.android.xposed.installer/log/debug.log（通过Xposed Installer可以轻易访问到）输出信息（tag Xposed）。</p>
<h2 id="assetsxposed_init">assets/xposed_init</h2>
<p>现在唯一遗漏的就是提示XposedBridge哪些类包含了入口点。这项工作通过一个叫 xposed_init 的文件完成。在assets文件夹下创建一个新的名叫xposed_init的text文件。在该文件中每行包含一个类的全名。在这个例子中，它是 de.robv.android.xposed.mods.tutorial.Tutorial。</p>
<h2 id="试试看"># 试试看</h2>
<p>保存你的文件。以Android Application的方式运行你的程序。因为这是你第一次安装它，在使用前你需要先启用。打开Xposed Installer这个app并确保你安装了xposed框架。之后切换到Modules标签。你应该能在那里找到你的app。在选择框内打钩使得它可用。然后重启。你当然什么变化也看不到，但如果检查log记录，以应该会看见以下的东西：</p>
<pre><code>Loading Xposed (for Zygote)...
Loading modules from   /data/app/de.robv.android.xposed.mods.tutorial-1.apk
Loading class de.robv.android.xposed.mods.tutorial.Tutorial
Loaded app: com.android.systemui
Loaded app: com.android.settings
... (many more apps follow)</code></pre>
<p>瞧！它起作用了。现在你拥有了一个Xposed模块。它能够变得比写一些log更加有用…</p>
<h2 id="探索你的目标并寻找修改它的方式"># 探索你的目标并寻找修改它的方式</h2>
<p>好了，下面要开始讲的部分也许会非常不同，这取决于你想做什么。如果你之前修改过apk，也许你会知道在这里应当如何思考。总的来说，你需要了解目标的一些实现细节。在本教程中，目标选定为状态栏的时钟。这有助于了解到状态栏以及其他一些东西都是系统UI的一部分。现在让我们在那里开始我们的探索。</p>
<p>可能性1：反汇编。这会告诉你它实际的实现，但是会很难阅读和理解，因为你得到的都是smali格式的东西。可能性2：获得AOSP源代码。比如<a target="_blank" rel="noopener" href="http://source.android.com/source/downloading.html">这里</a>，<a target="_blank" rel="noopener" href="http://grepcode.com/snapshot/repository.grepcode.com/java/ext/com.google.android/android/4.0.3_r1/">这里</a>。ROM不同代码也很不一样，但在本例中他们的实现是相似的甚至是相同的。我会先看AOSP，然后看看这么做够不够。如果我需要细节，我会看看实际的反汇编的代码。</p>
<p>你可以找找名称中有“clock”的类。其他需要找的是用到的资源和布局。如果你下载官方的AOSP代码，你可以从 frameworks/base/packages/SystemUI 开始找。你会找到好几处“clock”出现的地方。找到有好几种方式实现修改是正常而且真实的。时刻记住你“只能” hook方法。所以你必须另找其他能够插入代码实现功能的地方，要么在方法的前面或是后面，或者是替换掉方法。你应当hook一个尽可能明确的方法，而不是一个被调用成千上万次的用于解决性能问题和非计划中的副作用的方法。</p>
<p>在本例当中，你或许会发现布局 res/layout/status_bar.xml 包含一个指向带有类com.android.systemui.statusbar.policy.Clock的自定义view。现在你脑子里也许会有好多点子。文字的颜色是通过textAppearance属性定义的，所以最干净的更改它的方法就是修改外观的定义。然而，用Xposed框架改变外观属性几乎是不可能的（这需要深入本地代码）。替换状态栏的布局也许是可能的，但对于你试图做出的小小修改来说是杀鸡用牛刀。取而代之的是，看看这个类。有一个叫updateLock的方法，似乎每分钟都调用一次用于更新时间。</p>
<pre><code>final void updateClock() &#123;
    mCalendar.setTimeInMillis(System.currentTimeMillis());
    setText(getSmallTime());
&#125;</code></pre>
<p>这个方法用于修改来说是很好的，因为这是一个足够具体的看似唯一能够修改时钟文字的方法。如果我们在这个方法的每次调用之后都加些修改时钟文字和颜色的东西，应该就能起作用。那么，我们开始做吧。</p>
<blockquote>
<p>对于单独修改字体颜色部分，有一种更好的办法。参见“<a target="_blank" rel="noopener" href="https://github.com/rovo89/XposedBridge/wiki/Replacing-resources">替换资源</a>”中“修改布局”的例子。</p>
</blockquote>
<h2 id="使用反射寻找并hook方法"># 使用反射寻找并hook方法</h2>
<p>现在我们已经知道了哪些东西？我们在com.android.systemui.statusbar.policy.Clock有一个叫做updateClock的希望干涉的方法。我们在系统UI资源中找到了这个类，所以它仅仅在系统UI进程当中有效。其它一些类属于框架，而且在任何地方都有效。如果我们在 handleLoadPackage 中试图直接获取任何这个类的信息和引用，就会失败。因为处于错误的进程中。所以让我们实现一种仅在某个特定包即将加载时执行特定代码的情况：</p>
<pre><code>public void handleLoadPackage(LoadPackageParam lpparam) throws Throwable &#123;
    if (!lpparam.packageName.equals(&quot;com.android.systemui&quot;))
        return;

    XposedBridge.log(&quot;we are in SystemUI!&quot;);
&#125;</code></pre>
<p>使用参数，我们能轻松检查是否在正确的包中。一旦我们核实了这一点，我们就通过ClassLoader取得那个包中的也被这个变量引用的类。现在我们可以寻找com.android.systemui.statusbar.policy.Clock这个类以及它的updateClock方法，然后告诉XposedBridge去hook这个方法：</p>
<pre><code>package de.robv.android.xposed.mods.tutorial;

import static de.robv.android.xposed.XposedHelpers.findAndHookMethod;
import de.robv.android.xposed.IXposedHookLoadPackage;
import de.robv.android.xposed.XC_MethodHook;
import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;

public class Tutorial implements IXposedHookLoadPackage &#123;
    public void handleLoadPackage(final LoadPackageParam lpparam) throws Throwable &#123;
        if (!lpparam.packageName.equals(&quot;com.android.systemui&quot;))
            return;

        findAndHookMethod(&quot;com.android.systemui.statusbar.policy.Clock&quot;, lpparam.classLoader, &quot;updateClock&quot;, new XC_MethodHook() &#123;
                @Override
                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;
                // this will be called before the clock was updated by the original method
            &#125;
            @Override
            protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;
                // this will be called after the clock was updated by the original method
            &#125;
    &#125;);
    &#125;
&#125;</code></pre>
<p>findAndHookMethod是一个<a target="_blank" rel="noopener" href="https://github.com/rovo89/XposedBridge/wiki/Helpers">Helper</a>函数。注意静态导入，如果你像连接中说的一样做了，那就会被自动加入。这个方法使用系统UI包的ClassLoader寻找 Clock 这个类，然后寻找其中的updateClock方法。如果这个方法中有任何参数，你必须事后列出这些参数的类型。有许多方法做这件事，但因为我们的方法没有参数，所以就先跳过这个步骤。至于最后一点，你需要提供一个 XC_MethodHook 类的实现。对于更小的更改，你可以使用匿名类。如果你的代码很多，最好创建普通的类并且只在这里创建实例。helper之后会如之前所说的，做出所有hook这个方法的必要工作。</p>
<p>XC_MethodHook中有两个你可以重写的方法。你可以两个都重写，或者都不重写。但后者的做法显然是没有道理的。这些方法就是beforeHookedMethod 和 afterHookedMethod。不难猜出他们在原有方法之前/后执行。你可以使用“before”方法在方法调用前估计/操纵参数（通过param.args）。甚至阻止调用原来的方法（发送你自己的结果）。“after”方法可以用来做一些基于原来方法的结果的事。你也可以在这个地方操纵结果。当然，你可以在方法调用的前/后添加你自己要执行的代码。</p>
<blockquote>
<p>如果你要彻底替换一个方法，去看看子类XC_MethodReplacement。在那里，你只需要重写replaceHookedMethod。</p>
</blockquote>
<p>XposedBridge为每个hook过的方法维护一个注册过的回调的表。拥有最高优先级（在hookMethod中被定义）的将被优先调用。原有的方法总是具有最低的优先级。所以如果你hook了一个拥有回调A（高优先级）和回调B（默认优先级）的方法，那么不管被hook的方法是如何被调用的，执行顺序总是这样的：A.before -&gt; B.before -&gt; original method -&gt; B.after -&gt; A.after。所以A可以影响B看到的参数，即把它们传递下去以前大幅度地修改它们。原有的方法的结果会先被B处理，但是A拥有原先调用者最终将得到什么样结果的决定权。</p>
<h2 id="最终步骤在方法调用之前后执行你自己的代码">最终步骤：在方法调用之前/后执行你自己的代码</h2>
<p>好了，你已经在正确的上下文运行环境中（比如：系统UI进程）有了一个在updateClock方法每次被调用时都会被调用的方法。现在让我们修改一些东西吧。</p>
<p>第一个要检查的：我们有具体的Clock类型的引用么？是的，我们有。这就是param.thisObject参数。所以如果方法通过myClock.updateClock()被调用，那么param.thisObject 就是 myClock。</p>
<p>接下来：我们对clock做什么？Clock类型并不可用，你不能将param.thisObject转换为类（也不要试着这样做）。然而它是从TextView继承而来。所以一旦你把Clock的引用转换为TextView，你可以使用像setText, getText 和 setTextColor之类的方法。我们的改动应该在原有的方法设置了新的时间以后进行。因为在方法被调用前什么都没有做，我们可以空着beforeHookedMethod。没有必要调用（空的）“super”方法。</p>
<p>所以以下是完整的源代码：</p>
<pre><code>package de.robv.android.xposed.mods.tutorial;

import static de.robv.android.xposed.XposedHelpers.findAndHookMethod;
import android.graphics.Color;
import android.widget.TextView;
import de.robv.android.xposed.IXposedHookLoadPackage;
import de.robv.android.xposed.XC_MethodHook;
import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;

public class Tutorial implements IXposedHookLoadPackage &#123;
    public void handleLoadPackage(final LoadPackageParam lpparam) throws Throwable &#123;
        if (!lpparam.packageName.equals(&quot;com.android.systemui&quot;))
            return;

        findAndHookMethod(&quot;com.android.systemui.statusbar.policy.Clock&quot;, lpparam.classLoader, &quot;updateClock&quot;, new XC_MethodHook() &#123;
            @Override
            protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;
                TextView tv = (TextView) param.thisObject;
                String text = tv.getText().toString();
                tv.setText(text + &quot; :)&quot;);
                tv.setTextColor(Color.RED);
            &#125;
        &#125;);
    &#125;
&#125;</code></pre>
<h2 id="对结果感到满意"># 对结果感到满意</h2>
<p>现在启动/安装你的app。因为你第一次启动它时已经在Xposed Installer中把它设置为了可用，你就不需要在做这一步了。重启即可。然而，如果你正在使用这个红色钟表的例子，你也许想禁用它。两者都对它们的updateClock 处理程序使用了默认的优先级。所以你不清楚哪个会胜出（实际上这依赖于处理方法的字符串表示形式，但不要依赖这个方式）。</p>
<h2 id="结论"># 结论</h2>
<p>我知道这个教程很长。但我希望你现在不但能实现一个绿色的表，也能够做出一些完全不同的东西。找到好的被hook的方法是经验的问题，所以先从简单的做起。试着一开始多使用log函数确保每次调用都是你预期的。现在：祝玩得开心!</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://vbill.github.io/2015/02/06/GitIgnore/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BillVYoung">
      <meta itemprop="description" content="一个普通的Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BillVYoung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/02/06/GitIgnore/" class="post-title-link" itemprop="url">GitIgnore使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-02-06 20:18:08" itemprop="dateCreated datePublished" datetime="2015-02-06T20:18:08+08:00">2015-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-18 17:29:14" itemprop="dateModified" datetime="2020-10-18T17:29:14+08:00">2020-10-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>假期和另外几个同学做一个安卓下的安全APP，一起在oschina上建了个私有仓库，用IntelliJ开发。Merge时候有几个文件冲突了。</p>
<p>为了防止提交上去的文件冲突，是一定要在项目的根目录下加上一个名叫”.gitignore”的文件。主要冲突的就是IntelliJ自身的工程配置文件，还有每个人调试程序生成的类以及apk.</p>
<p>主要参考<a target="_blank" rel="noopener" href="https://github.com/github/gitignore">https://github.com/github/gitignore</a>这里的内容写成。</p>
<pre><code># Built application files
*.apk
*.ap_
# Files for the Dalvik VM
*.dex
# Java class files
*.class
# Generated files
bin/
gen/
# Gradle files
.gradle/
build/
/*/build/
# Local configuration file (sdk path, etc)
local.properties
# Proguard folder generated by Eclipse
proguard/
# Log Files
*.log

# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm
*.iml
## Directory-based project format:
.idea/
# if you remove the above rule, at least ignore the following:
# User-specific stuff:
# .idea/workspace.xml
# .idea/tasks.xml
# .idea/dictionaries
# Sensitive or high-churn files:
# .idea/dataSources.ids
# .idea/dataSources.xml
# .idea/sqlDataSources.xml
# .idea/dynamic.xml
# .idea/uiDesigner.xml
# Gradle:
# .idea/gradle.xml
# .idea/libraries
# Mongo Explorer plugin:
# .idea/mongoSettings.xml
## File-based project format:
*.ipr
*.iws
## Plugin-specific files:
# IntelliJ
out/
# mpeltonen/sbt-idea plugin
.idea_modules/
# JIRA plugin
atlassian-ide-plugin.xml
# Crashlytics plugin (for Android Studio and IntelliJ)
com_crashlytics_export_strings.xml
crashlytics.properties
crashlytics-build.properties</code></pre>
<p>附上<a target="_blank" rel="noopener" href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/0013758404317281e54b6f5375640abbb11e67be4cd49e0000">gitignore</a>的小教程</p>
<p>比较全面的gitignore用法：<a target="_blank" rel="noopener" href="http://git-scm.com/docs/gitignore">http://git-scm.com/docs/gitignore</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://vbill.github.io/2015/01/08/after-move-blogs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BillVYoung">
      <meta itemprop="description" content="一个普通的Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BillVYoung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/01/08/after-move-blogs/" class="post-title-link" itemprop="url">搬迁博客后的一些感想</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-01-08 20:18:08" itemprop="dateCreated datePublished" datetime="2015-01-08T20:18:08+08:00">2015-01-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-18 17:29:14" itemprop="dateModified" datetime="2020-10-18T17:29:14+08:00">2020-10-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%84%9F%E6%83%B3/" itemprop="url" rel="index"><span itemprop="name">感想</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>学分大的课全考完了，今天继续把<a target="_blank" rel="noopener" href="http://blog.csdn.net/u011714944/">以前的博客</a>从csdn搬到了这里，然后全部搬完了。看到以前的博客，感觉第一遍学习时很多东西仅仅停留在掌握上，认识还不够深刻。就比如之前写的迷宫生成的程序，这学期末有个老师的班上也布置了这个作业，我看到我们班上有个选这个老师的课的同学，他的算法和我的略有不同（直接挖迷宫，不假设有“小房子”）。用他的算法生成的迷宫只有一条通向终点的路径，用我的方法可以有一条以上的路径。但我暑假写这个程序时却没思考过如何生成只有一个到终点的路径的迷宫。还有动态规划，以前也理解的很浅。现在看看一些以前写的代码，感觉就一<strong>烂</strong>字。</p>
<p>这学期自学了一点8086汇编，还写了一个安卓的播放器app，再后来又在写一个linux下的小工具。后来因为一些事情，原先的计划就都停下了。这学期一直没更博客。虽然大二很忙吧，但是也可以采取先挖个坑，以后再填上的办法嘛！</p>
<p>再回头来说对所学东西的认识这个问题。我现在觉得掌握和会用只是学东西的第一步。照着网上或教科书上的教程写个东西，或是用用别人的轮子，这都不算什么。我觉得能把书上东西弄懂，自己还会变通使用才行。用别人的轮子，自己还能修改，甚至别人把你的修改合并进来，那才算厉害。</p>
<p>还有学校开的专业基础课要学好。学好不全是指考试好，而是对学了什么，能用到哪里清清楚楚。实践才是最主要的。考试毕竟和实用还有很大差距。不过一般到了能用的水平，考试也就不会太差了。学校的课程虽然实践性不强，但是所学都是计算机科学的基础，只可惜这些课程大多也只讲授最基本的内容。我觉得对计算机本身构造的理解和算法的设计能力是在学校期间应该非常注意培养。简言之就是：底层+算法。如果对科研有兴趣的话还应该额外看一些数学和算法方面的书。计算机是门实用的学问，任何离开实际去学习的方法都是不可取的。最好的学习方法就是多动手。学习时多把书上看不明白的地方自己实现一遍，自己有好的想法也要实现一遍。以后工作的话估计很忙，能自由支配的学习时间可能不会很多。</p>
<p>另外，自己要培养自己的工程能力。说实话我现在做的还很糟糕，因为目前还没有项目经验（自己写的小玩意儿不算）。不过这不着急，毕竟上学期和这学期还在打基础，而且其实这个学期也做了一些准备工作了。下学期我看看有什么好的机会，要争取参加。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://vbill.github.io/2015/01/01/First-hexo-article/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BillVYoung">
      <meta itemprop="description" content="一个普通的Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BillVYoung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/01/01/First-hexo-article/" class="post-title-link" itemprop="url">About my blog</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-01-01 23:11:24" itemprop="dateCreated datePublished" datetime="2015-01-01T23:11:24+08:00">2015-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-18 17:29:14" itemprop="dateModified" datetime="2020-10-18T17:29:14+08:00">2020-10-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%84%9F%E6%83%B3/" itemprop="url" rel="index"><span itemprop="name">感想</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一直想搭建一个真正意义上自己的博客。之前在CSDN上面有博客，但是写的不勤。我觉得博客应该坚持写，把自己学到的知识总结好。其实写文章的过程是回顾自己所学的一个很好的途径。之前在CSDN上想写，但是总是以“ 这学期很忙” 来敷衍自己。我想博客如果是自己搭建的而不仅仅只是注册在某个网上的空间，也许就会认真对待些吧。所以就想到弄个个人的博客站点，顺便再把以前的文章搬运过来。本来说考完期末再弄，但是今天图书馆关门，晚上教学楼太冷，就回寝室自习了。结果在寝室里做题错误率爆涨，只好找点别的事做。大概也就这个事情不太耗费脑力了。正好新年开个头，弄个博客，希望今年自己在技术上多进步些吧。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://vbill.github.io/2014/10/05/git-commands/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BillVYoung">
      <meta itemprop="description" content="一个普通的Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BillVYoung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/10/05/git-commands/" class="post-title-link" itemprop="url">git基础常用指令汇总</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-10-05 15:54:00" itemprop="dateCreated datePublished" datetime="2014-10-05T15:54:00+08:00">2014-10-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-18 17:29:14" itemprop="dateModified" datetime="2020-10-18T17:29:14+08:00">2020-10-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>远程关联操作：</p>
<p>创建自己的仓库后，要关联一个远程库，使用命令git remote add origin git@server-name:path/repo-name.git；</p>
<p>关联后，使用命令git push -u origin master第一次推送master分支的所有内容；</p>
<p>此后，使用命令：git push origin '分支名称' 推送最新修改；</p>
<ul>
<li>克隆仓库：git clone git@github.com:GTIHUB账户名/仓库名.git</li>
<li>git remote -v 查看远程仓库详细信息</li>
<li>git branch - -set-upstream 分支名 origin/分支名 指定本地某分支与远程origin/某分支的链接</li>
<li>git pull 从服务器同步</li>
</ul>
<p>本地操作：</p>
<ul>
<li><p>git status 查看本地仓库状态</p></li>
<li><p>git add 'filename' 添加文件到本地缓存</p></li>
<li><p>git add -A 添加所有改动的文件</p></li>
<li><p>git commit -m 'commitment' 提交更改到本地并添加说明内容</p></li>
<li><p>在仓库目录下输入：git init，把这个目录变成仓库</p></li>
<li><p>git log 显示近三次的更改</p></li>
<li><p>git log --graph --pretty=oneline --abbrev-commit 查看分支图形</p></li>
<li><p>git reset --hard HEAD^ 退到上个版本</p></li>
<li><p>git reset --hard 'SHA-1编码' 退到SHA-1编码表示的版本</p></li>
<li><p>git diff HEAD -- 'FILE' 查看工作区文件与版本库文件的不同之处（可以省略HEAD后内容）</p>
<p>git checkout [选项] [<分支>] -- <文件>...</p>
<pre><code>-q, --quiet           不显示进度报告

-b &lt;分支&gt;             创建并检出一个新的分支

-B &lt;分支&gt;             创建/重置并检出一个分支

-l                    为新的分支创建引用日志

--detach              成为指向该提交的分离头指针

-t, --track           为新的分支设置上游信息

--orphan &lt;新分支&gt;     新的没有父提交的分支

-2, --ours            对尚未合并的文件检出我们的版本

-3, --theirs          对尚未合并的文件检出他们的版本

-f, --force           强制检出（丢弃本地修改）

-m, --merge           和新的分支执行三路合并

--overwrite-ignore    更新忽略的文件（默认）

--conflict &lt;风格&gt;     冲突输出风格（merge 或 diff3）

-p, --patch           交互式挑选数据块

--ignore-skip-worktree-bits 对路径不做稀疏检出的限制</code></pre></li>
</ul>
<p>git checkout -- 'readme.txt' 丢弃工作区的更改（后面--参数必须有）</p>
<p>对于提交到了暂存区的更改：先git reset HEAD file</p>
<p>删除文件时先直接把原文件删除。然后git rm '文件'，然后commit。如果是误删除git checkout -- '刚才删掉的文件'</p>
<p>在用户个人目录下：ssh-keygen -t rsa -C 'youremail@***.com' 生成密钥</p>
<p>分支管理：</p>
<ul>
<li>查看分支：git branch</li>
<li>创建分支：git branch name</li>
<li>切换分支：git checkout name</li>
<li>创建+切换分支：git checkout -b name</li>
<li>合并某分支到当前分支：git merge name</li>
<li>删除分支：git branch -d name 换成-D是强行删除</li>
<li>git merge --no-ff -m "merge with no-ff" dev 普通的合并模式</li>
</ul>
<p>BUG 修复时用到的命令：</p>
<p>修复bug时，创建新的bug分支进行修复，然后合并，最后删除； 当手头工作没有完成时，先git stash一下，然后去修复bug，修复后，再git stash pop，回到工作现场。</p>
<ul>
<li>git stash apply stash@{0} 恢复到指定的stash</li>
<li>git stash list 查看所有的stash现场</li>
<li>git stash pop 恢复工作并删除之前保存的现场</li>
<li>git stash 保存工作现场</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://vbill.github.io/2014/08/13/deep-back-search/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BillVYoung">
      <meta itemprop="description" content="一个普通的Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BillVYoung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/08/13/deep-back-search/" class="post-title-link" itemprop="url">回溯法搜索总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-08-13 21:59:00" itemprop="dateCreated datePublished" datetime="2014-08-13T21:59:00+08:00">2014-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-18 17:29:14" itemprop="dateModified" datetime="2020-10-18T17:29:14+08:00">2020-10-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近在看回溯搜索算法，觉得值得总结一下。</p>
<p>回溯法简单说就是，为了搜到合适的解做出尝试，尝试失败时就退回到之前状态，然后尝试其他的可能性。这类算法套路比较固定。总的思想我概括为：搜到就输出，搜不到就返回，符合条件就搜。</p>
<p>流程用文字描述，大概分为两类情况：</p>
<p>1.当搜索过程每前进一步，会遇到多种情况时：这类情况的代码形式上类似图的深度遍历</p>
<pre><code>void search(int k)&#123;
    if (达到目标) 输出解
    else
       for each(所有可能情况)
       if (满足递归条件)&#123;
         保存状态
         search(k+1)
         恢复之前的状态
       &#125;
&#125;</code></pre>
<p>2.当搜索过程每前进一步，只有两种选择时：这类情况的代码形式上类似二叉树的先根遍历</p>
<pre><code>void search(int k)&#123;
   if (达到目标) 输出解
   else&#123;
      if(符合选择1条件)&#123;
        保存状态和数据
        search(k+1, 参数1）
        恢复
      &#125;
      if(符合选择2条件)&#123;
        保存状态和数据
        search(k+1, 参数2）
        恢复
      &#125;
   &#125;        
&#125;</code></pre>
<p>当然不一定所有问题都严格遵守上面的步骤。比如，有的时候搜索的分支可能并没改变数据（之后有举例），这时保存数据这步是可以没有的。</p>
<p>回溯法的优点在于省内存，搜索过程中产生解空间。由于采用了递归和深度优先的策略，最大耗费空间仅仅和搜索的最大深度有关。</p>
<p>第一个例子，给出n和m，从1到n中挑出m个数，产生所有可能的排列数和组合数，n小于10：</p>
<pre><code>#include &lt;iostream&gt;
#include &lt;vector&gt;
using namespace std;

bool used[10]=&#123;false&#125;;//数字i是否使用过
int num[10];//n,m smaller than 10

int id1=0, id2=0;

vector&lt;int&gt; num2;
bool used2[10]=&#123;false&#125;;

void p(int n, int r, int k)&#123;
    if(k==0)&#123;
        id1++;
        cout&lt;&lt;id1&lt;&lt;&quot;: &quot;;
        for(int i=r; i&gt;=1; i--)cout&lt;&lt;num[i];
        cout&lt;&lt;&quot;\t&quot;;
    &#125;else&#123;
        for(int i=1; i&lt;=n; i++)&#123;
            if(!used[i])&#123;
                num[k]=i;
                used[i]=true;
                p(n,r,k-1);
                used[i]=false;
            &#125;
        &#125;
    &#125;
&#125;

void permutation(int n, int r)&#123;
    p(n,r,r);
&#125;

void c(int n, int r, int k)&#123;
    if((int)num2.size()==r)&#123;
        id2++;
        cout&lt;&lt;id2&lt;&lt;&quot;: &quot;;
        for(int i=0; i&lt;num2.size(); i++)cout&lt;&lt;num2[i];
        cout&lt;&lt;&quot;\t&quot;;
    &#125;else&#123;
        for(int i=k; i&lt;=n; i++)&#123;//i=k,保证排列结果是由小到大输出
            if(!used2[i])&#123;
                num2.push_back(i);
                used2[i]=true;//save
                c(n,r,i+1);//search
                used2[i]=false;
                num2.pop_back();//go back

            &#125;
        &#125;
    &#125;
&#125;

void combination(int n, int r)&#123;
    c(n,r,1);
&#125;

int main()&#123;
    int n,m;
    cin&gt;&gt;n&gt;&gt;m;
    cout&lt;&lt;&quot;permutation:&quot;&lt;&lt;endl;
    permutation(n,m);
    cout&lt;&lt;endl;
    cout&lt;&lt;&quot;combination&quot;&lt;&lt;endl;
    combination(n,m);
    return 0;
&#125;</code></pre>
<p>当然上面的例子是输出所有的排列和组合。大部分时候我们只是搜索特定的一个结果，或某些结果。因此舍弃不必要的解是很重要的。这就涉及限界，或者说剪枝。如果搜索到某一步时再接着搜肯定没有结果，那么就停止在这个分支的搜索，通常用一个限制条件或外加判断函数来判断。</p>
<p>第二个例子，给定一个集合，知道它有n个元素，希望从n个数中取出若干个使得它们的和为c。第一行输入n和c，第二行输入集合内的数。把可行的数字组合（1组就行）输出，如果没有符合条件的组合，就输出NO SOLUTION。</p>
<pre><code>#include &lt;iostream&gt;
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
using namespace std;

int n,c;
int a[9000];
int r=0, mi[9000],s[9000], l[9000];
//s=sum, mi=min, l=answer list
void work(int x, int z)&#123;
    if(z==c)&#123;
        for(int i=1; i&lt;=r; i++)&#123;
            cout&lt;&lt;l[i]&lt;&lt;&quot; &quot;;
            if(i==r) cout&lt;&lt;endl;
        &#125;
        exit(0);
    &#125;else&#123;
    //限制条件，如果当前的和加上剩下所有的数超过目标值，且当前的和加上剩下最小的
    也不超过目标值则继续搜索
        if( x&lt;=n &amp;&amp; z+mi[x]&lt;=c &amp;&amp; z+s[x]&gt;=c)&#123;
            if(z+a[x]&lt;=c)&#123;//do1, add a[x], when a[x] can be added
                r++;
                l[r]=a[x];//save

                work(x+1,z+a[x]);//do1

                r--;//back
            &#125;
            work(x+1,z);//do2, not to add a[x]
        &#125;
    &#125;
&#125;
/* 
    x增加时有两个选择，将下一个数挑出，或者不挑出，所以有do1和do2两个选择
*/

int main()&#123;
    scanf(&quot;%d%d&quot;, &amp;n, &amp;c);
    for(int i=1; i&lt;=n; i++)
        scanf(&quot;%d&quot;, &amp;a[i]);

    mi[n]=s[n]=a[n];
    for(int i=n-1; i&gt;=1; i--)&#123;
        if(a[i]&lt;mi[i+1]) mi[i]=a[i];
        else mi[i]=mi[i+1];
        s[i]=s[i+1]+a[i];
    &#125;
    work(1,0);

    cout&lt;&lt;&quot;No solution!&quot;&lt;&lt;endl;
    return 0;
&#125;</code></pre>
<p>有的时候在递归过程中一些结果可能会被重复搜索（即：走了不同的路线，但是到达了相同目的地 -_-|| ），我们还可以建立一个表储存搜索过的结果，如果发现搜过这个结果了，就不要继续递归，直接从表里读取，这样能避免大量的重复递归。这个实现起来相对容易，就不再举例了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://vbill.github.io/2014/08/07/install-centos7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BillVYoung">
      <meta itemprop="description" content="一个普通的Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BillVYoung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/08/07/install-centos7/" class="post-title-link" itemprop="url">CentOS 7 安装常见问题汇总</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-08-07 21:01:00" itemprop="dateCreated datePublished" datetime="2014-08-07T21:01:00+08:00">2014-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-18 17:29:14" itemprop="dateModified" datetime="2020-10-18T17:29:14+08:00">2020-10-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>前两天把CENTOS6.5升级到了CENTOS7。其实就是重新安装了新版。网上提供了在线升级的办法，但是经过本人尝试没有成功，最后下载了ISO镜像安装。</p>
<p>在线升级的方法看<a target="_blank" rel="noopener" href="http://www.oschina.net/translate/centos-6-to-centos-7-upgrade-procedure">这里</a>。但是需要先下载Preupgrade Assistant和redhat-upgrade-tool-cli这两个工具。工具下载地址在<a target="_blank" rel="noopener" href="http://dev.centos.org/centos/6/upg/x86_64/Packages/">这里</a>。一共4个RPM安装包。我在测试在线升级时安装包全部下载好了，只是最后重启后安装时每次到一个地方就自动重启然后重新安装，反复了好多次。</p>
<p>最后刻了个DVD安装好了。如果没有刻录盘可以使用dd命令把iso文件刻到U盘里代替，方法：dd if=xxx.iso of=/dev/sdb (假定U盘是sdb，不过一般都是硬盘sda，u盘sdb，注意sdb后不需要加数字)。如果想恢复U盘，不要在windows下格式化（经过亲自测试容量就成了ISO文件的大小），应该在linux下格式化。命令是：mkfs -t vfat /dev/sdb1。dd指令刻录的时间比较长，大概20多分钟电脑卡住会什么反应也没有。</p>
<p>用刻好的设备(DVD或U盘)引导启动，进入安装程序会出现三行字，第一行：Install CentOS7，第二行：Test this media &amp; install CentOS7，第三行：troubleshooting。如果选第一项直接安装失败（我就是选了第一行后在一个地方黑屏左上角一个光标一直闪，然后就卡住了），就进入Troubleshooting，里边有个install centos7 in basic graphic mode。之后会进入图形界面，记住选中文界面（英语好可以无视）。按照提示安装。</p>
<p>这里我的机子出了些BUG，只要调整/boot分区大小，保存修改结果后就会自动变为3MB。好在安装程序有个自动分区功能。如果出现相同状况或者不知道分区分多大好，可以使用这个功能。</p>
<p>安装好了就会提示重启。不过重启后发现WIN7的启动选项没了T_T。以前CENTOS6.5时好歹还有个OTHER选项。。。。。。</p>
<p>GRUB启动选项的修复：在CENTOS7下不再使用GRUB1，而是改用GRUB2。从此不再有menu.lst文件，而是改成了/boot/grub/grub.cfg这个文件。里面的配置格式和指令也变了。启动选项出现时按c，进入grub的命令行模式，输入ls能查看有哪些硬盘分区。依次输入以下命令：</p>
<ul>
<li>set root=(hd0,msdos1)</li>
<li>chainloader +1</li>
<li>boot</li>
</ul>
<p>hd0是硬盘，msdos1是WIN7的C盘。如果没成功就在set root里换几个分区。如果成功了，下次进入CENTOS7，修改/boot/grub/grub.cfg，添加下面内容：</p>
<pre><code>menuentry &quot;WIN7&quot; &#123;
     set root=(hd0,msdos1)
     chainloader +1
&#125;</code></pre>
<p>这些都弄好后，去下载个显卡驱动装上，否则CPU发热超大（我的是AMD RADEON HD 8570M）。下载前注意看是不是最新版，是否支持3.10的linux内核。</p>
<p>最后，CENTOS7废除了service指令，所有服务都改用systemctl指令，如果输入service系统会自动切到systemctl。而且输入setup后进入系统自启动项目的管理页面会发现少了很多系统自启动服务。新的修改方法就是用systemctl指令。</p>
<ul>
<li>systemctl list-unit-files 显示所有服务及状态</li>
<li>systemctl start xxx.service 启动服务</li>
<li>systemctl stop xxx.service 关闭服务</li>
<li>systemctl restart xxx.service 重启服务</li>
<li>systemctl enable xxx.service 开机启动服务</li>
<li>systemctl disable xxx.service 取消开机启动服务</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="">
    <link itemprop="mainEntityOfPage" href="https://vbill.github.io/2014/07/27/mybatis-0toadcq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BillVYoung">
      <meta itemprop="description" content="一个普通的Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BillVYoung's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2014/07/27/mybatis-0toadcq/" class="post-title-link" itemprop="url">mybatis 从零基础到增删改查数据库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-07-27 16:02:00" itemprop="dateCreated datePublished" datetime="2014-07-27T16:02:00+08:00">2014-07-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-18 17:29:14" itemprop="dateModified" datetime="2020-10-18T17:29:14+08:00">2020-10-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文是mybatis框架一个初步的入门总结，最全的最好的资料应该参考<a target="_blank" rel="noopener" href="http://mybatis.github.io/mybatis-3/zh/index.html">这个</a></p>
<p>本文在Eclipse下搭建一个小程序可以测试mybatis对mysql数据库进行增删改查这几个基本功能。</p>
<p>1.首先建立数据库，我建立的数据库叫test，编码是UTF-8，里面有两张表，它们是这样的：</p>
<figure>
<img src="/img/mybatis_0toadcq/1.png" alt="" /><figcaption>pic1</figcaption>
</figure>
<p>两张表的数据我填的是这样的，当然可以随便填，不过最好在person中有1个以上name相同的，后面会用到：</p>
<figure>
<img src="/img/mybatis_0toadcq/2.png" alt="" /><figcaption>pic2</figcaption>
</figure>
<p>2.在ECLIPISE下建立DYNAMIC WEB PROJECT，别忘了在BUILD PATH下加入mybatis和mysql的jar包。这个工程的布局是这样的：</p>
<p>文件和类的用途后面解释</p>
<figure>
<img src="/img/mybatis_0toadcq/3.png" alt="" /><figcaption>pic3</figcaption>
</figure>
<p>Main里面有程序的static void main函数。Test类封装了测试mybatis框架功能的函数。xml都是框架的配置文件。Person与Student是DTO数据传输对象。两个Mapper类都是接口类，用途后面讲。</p>
<p>3.配置Configuration.xml。在src文件夹下先建立这个文件。</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;
    &lt;typeAliases&gt; 
        &lt;typeAlias alias=&quot;Person&quot; type=&quot;com.ymy.mybatis.model.Person&quot;/&gt; 
        &lt;typeAlias alias=&quot;Student&quot; type=&quot;com.ymy.mybatis.model.Student&quot;/&gt; 
        &lt;!-- short name of java classes --&gt;
    &lt;/typeAliases&gt; 

    &lt;environments default=&quot;development&quot;&gt;
        &lt;environment id=&quot;development&quot;&gt;
            &lt;!--
            choose any name for default and id
              --&gt;
        &lt;transactionManager type=&quot;JDBC&quot;/&gt;
            &lt;dataSource type=&quot;POOLED&quot;&gt;
            &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
            &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://127.0.0.1:3306/test&quot;/&gt;
            &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
            &lt;property name=&quot;password&quot; value=&quot;31415926&quot;/&gt;
            &lt;property name=&quot;driver.encoding&quot; value=&quot;UTF8&quot;/&gt;
            &lt;!--property name=&quot;PROPERTY NAME&quot; value=&quot;$&#123;var name&#125;&quot;/--&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;
    
    &lt;mappers&gt;
        &lt;mapper resource=&quot;com/ymy/mybatis/model/Person.xml&quot;/&gt;
        &lt;mapper resource=&quot;com/ymy/mybatis/model/Student.xml&quot;/&gt;
        &lt;!-- xml of mapper class --&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;</code></pre>
<p>标签解释：</p>
<pre><code>&lt;typeAliases&gt; 定义的是别名，全名是type里的一大串，起个别名减少了后面的书写量。

&lt;environments&gt;和&lt;environment&gt;配置了数据库的信息，一个environments下可以配多个environment来访问多个数据库，这超出了本文讨论范围。这个文章：http://zhangbo-peipei-163-com.iteye.com/blog/2052924讲了多数据源配置。

&lt;property name&gt;和value改成自己的数据库的就行了

&lt;mappers&gt;下定义多个&lt;mapper&gt;每个mapper对应一个DTO类型，以及它们对应的数据库操作。mapper resource后面是对应DTO的xml文件的实际位置。</code></pre>
<p>3.建立DTO类Student和Person。</p>
<p>Student类:</p>
<pre><code>package com.ymy.mybatis.model;

public class Student &#123;
    private int id;
    private String name;
    private int score;

    public Student() &#123;
    &#125;

    public int getID() &#123;
        return id;
    &#125;

    public void setID(int id) &#123;
        this.id = id;
    &#125;

    public String getName() &#123;
        return name;
    &#125;

    public void setName(String name) &#123;
        this.name = name;
    &#125;

    public int getScore() &#123;
        return score;
    &#125;

    public void setScore(int score) &#123;
        this.score = score;
    &#125;
&#125;</code></pre>
<p>Person类：</p>
<pre><code>package com.ymy.mybatis.model;

public class Person &#123;
    private int id;
    private String name;
    private int age;
    private String address;

    public Person(String name, int age, String address) &#123;
        this.name = name;
        this.age = age;
        this.address = address;
    &#125;

    public Person(int id, String name, int age, String address) &#123;
        this.id = id;
        this.name = name;
        this.age = age;
        this.address = address;
    &#125;

    public Person() &#123;
    &#125;

    public int getId() &#123;
        return id;
    &#125;

    public void setId(int id) &#123;
        this.id = id;
    &#125;

    public String getName() &#123;
        return name;
    &#125;

    public void setName(String name) &#123;
        this.name = name;
    &#125;

    public int getAge() &#123;
        return age;
    &#125;

    public void setAge(int age) &#123;
        this.age = age;
    &#125;

    public String getAddress() &#123;
        return address;
    &#125;

    public void setUserAddress(String userAddress) &#123;
        this.address = userAddress;
    &#125;
&#125;</code></pre>
<p>4.配置Student.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; 
&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;

&lt;mapper namespace=&quot;com.ymy.mybatis.model.StudentMapper&quot;&gt;
  &lt;select id=&quot;selectStudentByID&quot; parameterType=&quot;int&quot; resultType=&quot;Student&quot;&gt;
     select * from student where id = #&#123;id&#125;
 &lt;/select&gt;
&lt;/mapper&gt;</code></pre>
<p>解释：&lt; mapper namespace &gt;那句，相当于在命名空间com.ymy.mybatis.model.StudentMapper下定义了一个叫selectStudentByID的语句，它接收的参数类型（parameterType）为int，返回类型为Student。到后面我们定义了接口类StudentMapper，mybatis就会把接口中的函数和xml中的定义绑定。&lt; select &gt;标签说明这是查询类型的操作。</p>
<p>接口类StudentMapper：</p>
<pre><code>package com.ymy.mybatis.model;

public interface StudentMapper &#123;
    public Student selectStudentByID(int id);
&#125;</code></pre>
<p>配置Person.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; 
&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;

&lt;mapper namespace=&quot;com.ymy.mybatis.model.PersonMapper&quot;&gt;
     &lt;resultMap id=&quot;personResultMap&quot; type=&quot;Person&quot;&gt;
            &lt;id property=&quot;id&quot; column=&quot;id&quot; /&gt;
             &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;
             &lt;result property=&quot;age&quot; column=&quot;age&quot;/&gt;
             &lt;result property=&quot;address&quot; column=&quot;address&quot;/&gt;
    &lt;/resultMap&gt;

    &lt;select id=&quot;selectPersonByID&quot; parameterType=&quot;int&quot; resultType=&quot;Person&quot;&gt;
         select * from person where id = #&#123;id&#125;
    &lt;/select&gt;

    &lt;select id=&quot;selectPersonByName&quot; parameterType=&quot;String&quot; resultMap=&quot;personResultMap&quot;&gt;
         select * from person where name = #&#123;name&#125;
    &lt;/select&gt;

    &lt;select id=&quot;lastInsertId&quot; resultType=&quot;int&quot;&gt;
          select last_insert_id()
    &lt;/select&gt;

    &lt;insert id=&quot;addPerson&quot; parameterType=&quot;Person&quot;&gt;
            insert into person (id,name,age,address)
            values (NULL,#&#123;name&#125;,#&#123;age&#125;,#&#123;address&#125;)
    &lt;/insert&gt;

    &lt;update id=&quot;updatePerson&quot; parameterType=&quot;Person&quot;&gt;
            update person set
            name = #&#123;name&#125;,
            age = #&#123;age&#125;,
            address= #&#123;address&#125;
            where id = #&#123;id&#125;
    &lt;/update&gt;

    &lt;delete id=&quot;deletePerson&quot; parameterType=&quot;int&quot;&gt;
         delete from person where id = #&#123;id&#125;
    &lt;/delete&gt;
&lt;/mapper&gt;</code></pre>
<p>看sql语句就知道都是干啥的了，增删改查已经全了。重点是selectPersonByName。数据库里有重名的人，所以会查询到多个人。这时返回类型标签成了resultMap。值为personResultMap。文件最前面定义了personResultMap。result里面property是DTO里变量的名称。column和数据库里的名称对应。</p>
<p>接口类PersonMapper:</p>
<pre><code>package com.ymy.mybatis.model;

import java.util.List;

public interface PersonMapper &#123;
    public Person selectPersonByID(int id);
    public List&lt;Person&gt; selectPersonByName(String name);
    
    public void addPerson(Person person);
    public void deletePerson(int id);
    public void updatePerson(Person person);
    public int lastInsertId();
&#125;</code></pre>
<p>5.写测试代码：</p>
<p>Test类：</p>
<pre><code>package com.ymy.mybatis.test;

import java.io.*;
import java.util.*;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import com.ymy.mybatis.model.*;

public class Test &#123;
    private static SqlSessionFactory sqlSessionFactory;
    // it should be static
    // every thread should have its own SqlSession instance
    private static Reader reader;
    static &#123;
        try &#123;
            reader = Resources.getResourceAsReader(&quot;Configuration.xml&quot;);
            sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader);
            // every database should have its own SqlSessionFactory
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
        &#125;
    &#125;

    public void getPersonList(String userName) &#123;
        SqlSession session = sqlSessionFactory.openSession();
        try &#123;
            PersonMapper mapper = session.getMapper(PersonMapper.class);
            List&lt;Person&gt; people = mapper.selectPersonByName(userName);
            for (Person person : people) &#123;
                System.out.print(&quot;Name: &quot; + person.getName() + &quot;\t&quot;);
                System.out.print(&quot;Age: &quot; + person.getAge() + &quot;\t&quot;);
                System.out.println(&quot;Addr: &quot; + person.getAddress());
            &#125;
        &#125; finally &#123;
            session.close();
        &#125;
    &#125;

    public void addPerson() &#123;
        @SuppressWarnings(&quot;resource&quot;)
        Scanner inputer = new Scanner(System.in);
        System.out.println(&quot;Input a person&#39;s name age and address&quot;);
        String name = inputer.next();
        int age = inputer.nextInt();
        String address = inputer.next();

        Person newPerson = new Person(name, age, address);
        SqlSession session = sqlSessionFactory.openSession();
        try &#123;
            PersonMapper mapper = session.getMapper(PersonMapper.class);
            mapper.addPerson(newPerson);
            int last_id = mapper.lastInsertId();
            System.out.println(&quot;Insert id = &quot; + last_id);
            session.commit();
        &#125; finally &#123;
            session.close();
        &#125;
    &#125;
    
    public void updatePerson() &#123;
        @SuppressWarnings(&quot;resource&quot;)
        Scanner inputer = new Scanner(System.in);
        System.out.println(&quot;Input a person&#39;s id, name, age and address&quot;);
        int id = inputer.nextInt();
        String name = inputer.next();
        int age = inputer.nextInt();
        String address = inputer.next();

        Person person = new Person(id, name, age, address);
        SqlSession session = sqlSessionFactory.openSession();
        try &#123;
            PersonMapper mapper = session.getMapper(PersonMapper.class);
            mapper.updatePerson(person);
            session.commit();
            System.out.println(&quot;OK!&quot;);
        &#125; finally &#123;
            session.close();
        &#125;
    &#125;

    public void deletePerson() &#123;
        @SuppressWarnings(&quot;resource&quot;)
        Scanner inputer = new Scanner(System.in);
        System.out.println(&quot;Input an id to delete:&quot;);
        int id = inputer.nextInt();

        SqlSession session = sqlSessionFactory.openSession();
        try &#123;
            PersonMapper mapper = session.getMapper(PersonMapper.class);
            mapper.deletePerson(id);
            session.commit();
        &#125; finally &#123;
            session.close();
        &#125;
    &#125;
    
    public void selectPersonById()&#123;
        @SuppressWarnings(&quot;resource&quot;)
        Scanner inputer = new Scanner(System.in);
        System.out.println(&quot;Input an id to select:&quot;);
        int id = inputer.nextInt();
        
        SqlSession session = sqlSessionFactory.openSession();
        try &#123;
            PersonMapper mapper = session.getMapper(PersonMapper.class);
            Person person = mapper.selectPersonByID(id);
            System.out.print(&quot;Name: &quot; + person.getName() + &quot;\t&quot;);
            System.out.print(&quot;Age: &quot; + person.getAge() + &quot;\t&quot;);
            System.out.println(&quot;Addr: &quot; + person.getAddress());
        &#125; finally &#123;
            session.close();
        &#125;
    &#125;
    
    public void selectStudentById()&#123;
        @SuppressWarnings(&quot;resource&quot;)
        Scanner inputer = new Scanner(System.in);
        System.out.println(&quot;Input an student id to select:&quot;);
        int id = inputer.nextInt();
        
        SqlSession session = sqlSessionFactory.openSession();
        try &#123;
            StudentMapper mapper = session.getMapper(StudentMapper.class);
            Student student = mapper.selectStudentByID(id);
            System.out.print(&quot;Name: &quot; + student.getName() + &quot;\t&quot;);
            System.out.print(&quot;ID: &quot; + student.getID() + &quot;\t&quot;);
            System.out.println(&quot;Score: &quot; + student.getScore());
        &#125; finally &#123;
            session.close();
        &#125;
    &#125;
    
&#125;</code></pre>
<p>解释：我们通过SqlSession类的对象获取映射（使用getMapper方法），通过映射调用Student和Person接口类里的函数。SqlSession参与数据库的管理事务。当执行了修改数据库内容的语句后调用commit()方法讲更改的内容写入数据库。完成后及时关闭SqlSession对象，调用close()方法。</p>
<p>最后写Main类，然后运行程序：</p>
<pre><code>package com.ymy.mybatis.test;

public class Main &#123;
    public static void main(String[] args) &#123;
        Test t1 = new Test();
        t1.selectPersonById();
        t1.getPersonList(&quot;Bill&quot;);// find Bill
        t1.addPerson();
        t1.deletePerson();
        t1.updatePerson();
        
        t1.selectStudentById();
    &#125;
&#125;</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BillVYoung</p>
  <div class="site-description" itemprop="description">一个普通的Blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://renyili.org/" title="https:&#x2F;&#x2F;renyili.org&#x2F;" rel="noopener" target="_blank">renyili</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BillVYoung</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


</body>
</html>
